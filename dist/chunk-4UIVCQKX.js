import{a as de}from"./chunk-KIOSF3XI.js";import{a as ee}from"./chunk-VKXV5I3W.js";import{a as me}from"./chunk-NIQKBJBG.js";import{d as pe,e as se}from"./chunk-TX7LC2PY.js";import{a as le}from"./chunk-EHGHV7SA.js";import{f as ce}from"./chunk-SXKB25RG.js";import{A as ae,k as ne,l as ie,q as oe,u as re}from"./chunk-EKOSEFZP.js";import"./chunk-U3QUSVWF.js";import{Z as te}from"./chunk-74RUH4UK.js";import{a as fe}from"./chunk-37JVPQS2.js";import{a as W,h as Z}from"./chunk-BXPCUMYM.js";import{$ as v,Ac as D,Bb as H,Bc as A,Cb as l,Db as S,Ea as U,Eb as h,Ga as a,Pa as w,Tb as C,Ub as z,V as L,Va as m,Vb as T,Wb as X,bb as s,cc as E,e as ue,gb as F,ha as u,hb as M,ia as f,jb as R,kb as I,lb as i,mb as r,nb as q,oa as O,ob as d,pb as _,rb as y,sb as g,sc as k,tb as p,tc as Y,ua as b,uc as G,vc as J,wb as $,yc as K,zc as Q}from"./chunk-SEJLVJPR.js";function he(t,n){if(t&1&&(i(0,"th",7),l(1),C(2,"titlecase"),r()),t&2){let e=n.$implicit;a(),h(" ",z(2,1,e.value)," ")}}function Ce(t,n){t&1&&(i(0,"th"),l(1," Opciones "),r())}function ve(t,n){if(t&1&&(i(0,"tr"),R(1,he,3,3,"th",7,M),m(3,Ce,2,0,"th",8),r()),t&2){let e=p();a(),I(e.cols),a(2),s("ngIf",e.actions.length>0)}}function be(t,n){if(t&1&&(d(0),i(1,"td"),l(2),C(3,"date"),r(),_()),t&2){let e=p().$implicit,o=p().$implicit;a(2),h(" ",T(3,1,o[e.key],"dd/MM/yyyy")," ")}}function ye(t,n){if(t&1&&(d(0),i(1,"td"),l(2),C(3,"currency"),r(),_()),t&2){let e=p().$implicit,o=p().$implicit;a(2),h(" ",T(3,1,o[e.key],"USD")," ")}}function Se(t,n){if(t&1&&(d(0),i(1,"td"),l(2),r(),_()),t&2){let e=p().$implicit,o=p().$implicit;a(2),h(" ",o[e.key]," ")}}function Te(t,n){if(t&1&&(d(0,9),m(1,be,4,4,"ng-container",11)(2,ye,4,4,"ng-container",11)(3,Se,3,1,"ng-container",12),_()),t&2){let e=n.$implicit;s("ngSwitch",e.key),a(),s("ngSwitchCase","fecha"),a(),s("ngSwitchCase","valor")}}function Ee(t,n){if(t&1){let e=y();i(0,"button",15),g("click",function(){u(e);let c=p().$implicit,x=p(2).$implicit,P=p();return f(P.onAction(c.action,x))}),q(1,"img",16),r()}if(t&2){let e=p().$implicit;$("title",e.title),a(),$("src",e.icon,U)}}function we(t,n){if(t&1&&m(0,Ee,2,2,"button",14),t&2){let e=n.$implicit,o=p(2).$implicit;s("ngIf",!(e.action==="Checkout"&&o.estado!=="EN PROCESO"))}}function Me(t,n){if(t&1&&(d(0),R(1,we,1,1,"button",13,M),_()),t&2){let e=p(2);a(),I(e.actions)}}function Re(t,n){if(t&1&&(i(0,"tr"),R(1,Te,4,3,"ng-container",9,M),i(3,"td")(4,"div",10),m(5,Me,3,0,"ng-container",8),r()()()),t&2){let e=p();a(),I(e.cols),a(4),s("ngIf",e.actions.length>0)}}function Ie(t,n){t&1&&(i(0,"tr")(1,"td",17),l(2," No hay registros disponibles "),r()())}var B=class t{title="";cols=[];dataSource=[];actions=[];action=new O;onAction(n,e){this.action.emit({action:n,row:e})}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=w({type:t,selectors:[["table-report"]],inputs:{title:"title",cols:"cols",dataSource:"dataSource",actions:"actions"},outputs:{action:"action"},decls:8,vars:3,consts:[[1,"mt-5","h-[500px]","bg-white","rounded-lg","p-4","flex","flex-col","items-center"],[1,"text-xl","font-bold","mb-4","italic","text-gray-400"],[1,"w-full","overflow-auto"],["stripedRows","","scrollHeight","400px",3,"value","scrollable"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"text-center"],[4,"ngIf"],[3,"ngSwitch"],[1,"w-full","contents"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],[1,"transition-all","duration-300","active:brightness-80",3,"title"],["class","transition-all duration-300 active:brightness-80",3,"title","click",4,"ngIf"],[1,"transition-all","duration-300","active:brightness-80",3,"click","title"],["alt","",1,"w-[30px]","ml-1",3,"src"],["colspan","100%",1,"text-center","py-4","text-gray-500"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"h2",1),l(2),r(),i(3,"div",2)(4,"p-table",3),m(5,ve,4,1,"ng-template",4)(6,Re,6,1,"ng-template",5)(7,Ie,3,0,"ng-template",6),r()()()),e&2&&(a(2),h(" ",o.title," "),a(2),s("value",o.dataSource)("scrollable",!0))},dependencies:[A,k,Y,G,J,K,D,Q,se,pe,te],styles:["[_nghost-%COMP%]   th[_ngcontent-%COMP%]{color:#6495ed}"]})};var N=class t{#e=v(W);url=ee.API_URL;get(n){return this.#e.post(`${this.url}/reports/monthly`,n)}static \u0275fac=function(e){return new(e||t)};static \u0275prov=L({token:t,factory:t.\u0275fac,providedIn:"root"})};var j=ue(fe());function ke(t,n){t&1&&(d(0),i(1,"p",13),l(2,"Cargando datos..."),r(),_())}function De(t,n){if(t&1&&(i(0,"div",17)(1,"div",18)(2,"div",19)(3,"div",20)(4,"p"),l(5,"Total: "),i(6,"span",21),l(7),C(8,"currency"),r()(),i(9,"p"),l(10,"Trabajador del mes: "),i(11,"span",21),l(12),r()(),i(13,"p"),l(14,"Servicio m\xE1s solicitado: "),i(15,"span",21),l(16),r()(),i(17,"p"),l(18,"Cliente destacado: "),i(19,"span",21),l(20),r()()()()()()),t&2){let e=p(3);a(7),S(T(8,4,e.total(),"USD")),a(5),S(e.trabajadorDelMes()),a(4),S(e.servicioMasSolicitado()),a(4),S(e.clienteDelMes())}}function Ae(t,n){if(t&1){let e=y();i(0,"table-report",16),g("action",function(c){u(e);let x=p(2);return f(x.handleAction(c))}),r(),m(1,De,21,7,"div",17)}if(t&2){let e=p(2);s("title","Lista de veh\xEDculos")("cols",e.cols())("dataSource",e.services()),a(),F(e.services().length>0?1:-1)}}function Be(t,n){t&1&&(i(0,"div",15)(1,"p",22),l(2,"Seleccione una fecha para continuar"),r()())}function Ne(t,n){if(t&1&&(i(0,"div",14),m(1,Ae,2,4)(2,Be,3,0,"div",15),r()),t&2){let e=p();a(),F(e.services().length>0?1:2)}}var V=class t{#e=v(Z);#t=v(N);isLoading=b(!1);date=b(null);cols=b(me("monthlyReport"));services=b([]);total=E(()=>this.services().reduce((n,e)=>n+e.valor,0));trabajadorDelMes=E(()=>{let n=new Map;return this.services().forEach(e=>{n.set(e.trabajador,(n.get(e.trabajador)||0)+1)}),Array.from(n.entries()).reduce((e,[o,c])=>c>e.count?{value:o,count:c}:e,{value:"",count:0}).value});clienteDelMes=E(()=>{let n=new Map;return this.services().forEach(e=>{n.set(e.placa,(n.get(e.placa)||0)+1)}),Array.from(n.entries()).reduce((e,[o,c])=>c>e.count?{value:o,count:c}:e,{value:"",count:0}).value});servicioMasSolicitado=E(()=>{let n=new Map;return this.services().forEach(e=>{n.set(e.servicio,(n.get(e.servicio)||0)+1)}),Array.from(n.entries()).reduce((e,[o,c])=>c>e.count?{value:o,count:c}:e,{value:"",count:0}).value});selectedMonth(n){if(!n)return;this.isLoading.set(!0),this.date.set(n);let e=this.formatDate(n);this.#t.get(e).subscribe({next:o=>{if(o.length==0){j.default.fire({title:"Error",text:"No existe informaci\xF3n en el mes seleccionado",icon:"error",confirmButtonText:"Aceptar"}),this.isLoading.set(!1),this.services.set([]);return}this.services.set(o),this.services.set(this.services().filter(c=>c.trabajador!==null)),console.log(this.services()),this.isLoading.set(!1)},error:()=>{this.isLoading.set(!1),j.default.fire({title:"Error",text:"No se pudo obtener el reporte",icon:"error",confirmButtonText:"Aceptar"})}})}formatDate(n){return{month:n.getMonth()+1,year:n.getFullYear()}}exportReport(){if(this.services().length===0)return;let n=[this.cols().map(e=>e.key)];this.services().forEach(e=>{n.push(this.cols().map(o=>e[o.key]))}),console.log(n),de(n,"M")}salir(){j.default.fire({title:"\xBFEst\xE1 seguro?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#32cd32",cancelButtonColor:"#d33",confirmButtonText:"Si",cancelButtonText:"No"}).then(n=>{n.isConfirmed&&this.#e.navigate(["reports"])})}handleAction(n){}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=w({type:t,selectors:[["app-reports-month"]],decls:16,vars:7,consts:[["content",""],[1,"flex","flex-col","justify-center","px-6","py-12","w-screen"],[1,"flex","items-center","justify-center"],[1,"text-white","text-4xl","font-bold","text-center"],[1,"mt-5","flex","justify-center","items-center","w-full"],[1,"w-full","max-w-sm"],["variant","in"],["id","monthPicker","view","month","dateFormat","mm/yy",3,"ngModelChange","ngModel","readonlyInput","iconDisplay","showIcon"],["for","monthPicker"],[4,"ngIf","ngIfElse"],[1,"flex","justify-center","gap-2","mt-5"],["severity","success","label","EXPORTAR",3,"onClick","disabled"],["severity","danger","label","CANCELAR",3,"onClick"],[1,"text-white","text-center"],[1,"container","mx-auto","px-4","max-w-6x"],[1,"flex","justify-center","items-center","mt-4"],[3,"action","title","cols","dataSource"],[1,"mb-4"],[1,"p-6"],[1,"grid","grid-cols-1","md:grid-cols-2","text-white","text-l","mb-4","italic"],[1,"text-lg"],[1,"font-bold"],[1,"text-white","text-l","italic"]],template:function(e,o){if(e&1){let c=y();i(0,"div",1)(1,"div",2)(2,"h1",3),l(3," REPORTE MENSUAL "),r()(),i(4,"div",4)(5,"div",5)(6,"p-floatlabel",6)(7,"p-datepicker",7),g("ngModelChange",function(P){return u(c),f(o.selectedMonth(P))}),r(),i(8,"label",8),l(9,"Seleccione el mes"),r()()()(),m(10,ke,3,0,"ng-container",9)(11,Ne,3,1,"ng-template",null,0,X),i(13,"div",10)(14,"p-button",11),g("onClick",function(){return u(c),f(o.exportReport())}),r(),i(15,"p-button",12),g("onClick",function(){return u(c),f(o.salir())}),r()()()}if(e&2){let c=H(12);a(7),s("ngModel",o.date())("readonlyInput",!0)("iconDisplay","input")("showIcon",!0),a(3),s("ngIf",o.isLoading())("ngIfElse",c),a(4),s("disabled",o.services().length==0)}},dependencies:[le,ce,ae,oe,re,ie,ne,B,A,k,D],encapsulation:2})};export{V as default};
