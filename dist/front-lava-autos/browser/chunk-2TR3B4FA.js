import{a as te}from"./chunk-KIOSF3XI.js";import{a as O}from"./chunk-E3GALLMJ.js";import{a as M}from"./chunk-VKXV5I3W.js";import{a as Q,b as W,d as Y,e as Z}from"./chunk-HM7UTKQX.js";import{a as J}from"./chunk-YEA552Y6.js";import{a as ee}from"./chunk-UP23QCYC.js";import"./chunk-SVNXBQ6E.js";import{f as K}from"./chunk-BSIVO7KU.js";import{A as X,C as z,G as re,k as A,l as G,o as S,q as V,r as L,s as _,t as b,v as H,w as $,x as q,z as U}from"./chunk-P3IO33T2.js";import"./chunk-U3QUSVWF.js";import{Z as P}from"./chunk-2SOGP6GP.js";import{a as k,h as B}from"./chunk-B5AEI34L.js";import{Aa as a,Ba as f,Ja as I,Nb as h,Ob as g,P as E,Pa as u,U as w,Xa as s,ab as T,ba as R,ca as D,fb as t,gb as i,lb as F,mb as d,nb as x,uc as j,vc as N,wb as r,xb as p,yb as y}from"./chunk-S4YP6WBW.js";import{e as oe}from"./chunk-C6Q5SG76.js";var C=oe(re());var v=class n{constructor(o){this.http=o}url=M.API_URL;getDayReport(o){console.log(o);let e=o.toISOString().split("T")[0];return this.http.post(`${this.url}/reports/daily`,{fecha:e})}static \u0275fac=function(e){return new(e||n)(w(k))};static \u0275prov=E({token:n,factory:n.\u0275fac,providedIn:"root"})};function le(n,o){n&1&&(t(0,"tr")(1,"th",27),r(2,"Placa"),i(),t(3,"th",28),r(4,"Servicio"),i(),t(5,"th",28),r(6,"Trabajador"),i(),t(7,"th",27),r(8,"Valor"),i()())}function me(n,o){if(n&1&&(t(0,"tr")(1,"td"),r(2),i(),t(3,"td"),r(4),i(),t(5,"td"),r(6),i(),t(7,"td"),r(8),i()()),n&2){let e=o.$implicit;a(2),p(e.placa),a(2),p(e.servicio),a(2),p(e.trabajador),a(2),p(e.valor)}}function pe(n,o){n&1&&(t(0,"tr")(1,"th",28),r(2,"Placa"),i(),t(3,"th",29),r(4,"Servicio"),i(),t(5,"th",27),r(6,"Valor"),i()())}function se(n,o){if(n&1&&(t(0,"tr")(1,"td"),r(2),i(),t(3,"td"),r(4),i(),t(5,"td"),r(6),i()()),n&2){let e=o.$implicit;a(2),p(e.placa),a(2),p(e.servicio),a(2),p(e.valor)}}function ce(n,o){if(n&1){let e=F();t(0,"div",12)(1,"h2",13),r(2," LISTA DE INGRESOS "),i(),t(3,"div",14)(4,"p-table",15),u(5,le,9,0,"ng-template",16)(6,me,9,4,"ng-template",17),i()()(),t(7,"div")(8,"h2",18),r(9),h(10,"currency"),i()(),t(11,"div",19)(12,"div",20)(13,"h2",21),r(14,"Reporte por Trabajador"),i()(),t(15,"div",20)(16,"form",22)(17,"p-floatlabel",23)(18,"p-select",24),d("onChange",function(m){R(e);let c=x();return D(c.setEmployee(m))}),i(),t(19,"label",25),r(20,"Trabajador"),i()()()(),t(21,"div",26)(22,"div",12)(23,"h2",13),r(24," LISTA DE INGRESOS "),i(),t(25,"div",14)(26,"p-table",15),u(27,pe,7,0,"ng-template",16)(28,se,7,3,"ng-template",17),i()()(),t(29,"div")(30,"h2",18),r(31),h(32,"currency"),i()()()()}if(n&2){let e=x();a(4),s("value",e.ingresosdia)("scrollable",!0),a(5),y(" Total: ",g(10,10,e.totalIngDay)," "),a(7),s("formGroup",e.employeeForm),a(2),s("options",e.employees)("editable",!0)("appendTo","body"),a(8),s("value",e.ingresosFiltrados)("scrollable",!0),a(5),y(" Total a pagar: ",g(32,12,e.totalEmployee)," ")}}function de(n,o){n&1&&(t(0,"div",8)(1,"p",30),r(2,"Seleccione una fecha para continuar"),i()())}var ie=class n{constructor(o,e,l){this.reportsService=o;this.employeesService=e;this.router=l;this.employeesService.getAll().subscribe(m=>{this.employees=m})}fecha_string="";employees=[];ingresosdia=[];totalIngDay=0;totalEmployee=0;ingresosFiltrados=[];dateForm=new _({fecha:new b("",S.required)});employeeForm=new _({employee:new b(null,S.required)});setDate(o){let e=new Date(o);this.reportsService.getDayReport(e).subscribe(l=>{if(l.length==0){C.default.fire({title:"Error",text:"No existe informaci\xF3n en el d\xEDa seleccionado",icon:"error",confirmButtonText:"Aceptar"});return}console.log(l),this.ingresosdia=l,this.totalIngDay=this.ingresosdia.reduce((m,c)=>m+c.valor,0)})}setEmployee(o){console.log(o.value.nombre),console.log(this.ingresosdia),this.ingresosFiltrados=this.ingresosdia.filter(e=>e.trabajador===o.value.nombre),console.log(this.ingresosFiltrados),this.totalEmployee=this.ingresosFiltrados.reduce((e,l)=>e+l.valor,0)*o.value.porcentaje_servicio/100}exportReport(){if(this.ingresosdia.length===0)return;let o=[["Id","Placa","Servicio","Trabajador","Valor"]];this.ingresosdia.forEach(e=>{o.push([e.id,e.placa,e.servicio,e.trabajador,e.valor])}),te(o,"D")}salir(){C.default.fire({title:"\xBFEsta seguro?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#32cd32",cancelButtonColor:"#d33",confirmButtonText:"Confirmar",cancelButtonText:"Cancelar"}).then(o=>{o.isConfirmed&&(this.dateForm.reset(),this.employeeForm.reset(),this.ingresosFiltrados.length=0,this.router.navigate(["reports"]))})}static \u0275fac=function(e){return new(e||n)(f(v),f(ee),f(B))};static \u0275cmp=I({type:n,selectors:[["app-reports-day"]],decls:15,vars:3,consts:[[1,"flex","flex-col","justify-center","px-6","py-12","w-screen"],[1,"flex","items-center","justify-center"],[1,"text-white","text-4xl","font-bold","text-center"],[1,"mt-5","sm:mx-auto","sm:w-full","sm:max-w-sm"],[3,"formGroup"],["variant","in"],["chan","","showIcon","","iconDisplay","input","formControlName","fecha",3,"onSelect"],["for","fechaNacimiento"],[1,"flex","justify-center","items-center","mt-4"],[1,"flex","justify-center","gap-2","mt-5"],["severity","success","label","EXPORTAR",3,"onClick","disabled"],["severity","danger","label","CANCELAR",3,"onClick"],[1,"mt-5","h-[400px]","bg-white","rounded-lg","p-4","flex","flex-col","items-center"],[1,"text-xl","font-bold","mb-4","italic","text-gray-400"],[1,"w-full","overflow-auto"],["stripedRows","","scrollHeight","300px",3,"value","scrollable"],["pTemplate","header"],["pTemplate","body"],[1,"text-l","font-bold","mb-4","italic","text-white"],[1,"border-2","rounded-xl","border-white","p-4","mt-5"],[1,"mt-5","sm:mx-auto","sm:w-full","sm:max-w-sm","flex","justify-center"],[1,"text-white","text-2xl"],[1,"space-y-3",3,"formGroup"],["variant","in",1,"w-full"],["formControlName","employee","optionLabel","nombre",1,"w-full","!min-w-[120px]",3,"onChange","options","editable","appendTo"],["for","tipo",1,"text-sm","whitespace-nowrap","overflow-hidden","text-ellipsis"],[1,"flex-col","items-center","justify-center","w-screens"],[2,"color","cornflowerblue","width","20%"],[2,"color","cornflowerblue","width","30%"],[2,"color","cornflowerblue","width","50%"],[1,"text-white","text-l","italic"]],template:function(e,l){e&1&&(t(0,"div",0)(1,"div",1)(2,"h1",2),r(3,"REPORTE DIARIO"),i()(),t(4,"div",3)(5,"form",4)(6,"p-floatlabel",5)(7,"p-datepicker",6),d("onSelect",function(c){return l.setDate(c)}),i(),t(8,"label",7),r(9,"Seleccione la fecha"),i()()()(),u(10,ce,33,14)(11,de,3,0,"div",8),t(12,"div",9)(13,"p-button",10),d("onClick",function(){return l.exportReport()}),i(),t(14,"p-button",11),d("onClick",function(){return l.salir()}),i()()()),e&2&&(a(5),s("formGroup",l.dateForm),a(5),T(l.ingresosdia.length>0?10:11),a(3),s("disabled",l.ingresosdia.length==0))},dependencies:[U,H,V,L,K,J,O,P,X,$,q,z,Z,Y,W,Q,G,A,N,j],encapsulation:2})};export{ie as ReportsDayComponent};
