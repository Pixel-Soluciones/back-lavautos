import{a as oe}from"./chunk-6HSLBKDU.js";import{a as L}from"./chunk-GN6EZ355.js";import{a as re}from"./chunk-ZMK2ANYN.js";import{a as O}from"./chunk-VKXV5I3W.js";import{a as X,b as ee,d as te,e as ie}from"./chunk-TX7LC2PY.js";import{a as Q}from"./chunk-EHGHV7SA.js";import"./chunk-SXKB25RG.js";import{A as Y,B as Z,C as J,D as K,k as j,l as G,n as P,o as f,q,r as U,s as T,t as u,v as H,w as $,x as z,y as W}from"./chunk-EKOSEFZP.js";import"./chunk-U3QUSVWF.js";import{Z as M}from"./chunk-74RUH4UK.js";import{a as ae}from"./chunk-37JVPQS2.js";import{a as R,h as k}from"./chunk-BXPCUMYM.js";import{Ac as D,Bc as N,Cb as o,Db as S,Eb as B,Ga as c,Ha as h,Pa as A,Tb as w,Ub as I,V,Va as E,_ as F,bb as v,e as se,gb as y,ha as b,ia as C,lb as e,mb as r,nb as p,rb as g,sb as d,tb as _}from"./chunk-SEJLVJPR.js";var s=se(ae());var x=class l{constructor(t){this.http=t}url=O.API_URL;getAll(){return this.http.get(`${this.url}/vehicles`)}saveVehicle(t){return this.http.post(`${this.url}/vehicles/create`,t)}static \u0275fac=function(i){return new(i||l)(F(R))};static \u0275prov=V({token:l,factory:l.\u0275fac,providedIn:"root"})};function pe(l,t){l&1&&(e(0,"h1",2),o(1,"MODIFICAR INGRESO"),r())}function ue(l,t){l&1&&(e(0,"h1",2),o(1,"NUEVO INGRESO"),r())}function fe(l,t){l&1&&(e(0,"tr")(1,"th",38),o(2,"Servicio"),r(),e(3,"th",39),o(4,"Descripci\xF3n"),r(),e(5,"th",40),o(6,"Valor"),r(),e(7,"th",40),o(8,"Duraci\xF3n"),r(),e(9,"th",40),o(10,"Opci\xF3n"),r()())}function ve(l,t){if(l&1){let i=g();e(0,"tr")(1,"td"),o(2),r(),e(3,"td"),o(4),r(),e(5,"td"),o(6),w(7,"currency"),r(),e(8,"td"),o(9),r(),e(10,"td")(11,"div",41)(12,"button",42),d("click",function(){let m=b(i).$implicit,a=_();return C(a.eliminarServicio(m.id_servicio))}),p(13,"img",43),r()()()()}if(l&2){let i=t.$implicit;c(2),S(i.nombre_servicio),c(2),S(i.descrip_servicio),c(2),S(I(7,4,i.valor_servicio)),c(3),S(i.tiempo_estimado)}}function de(l,t){if(l&1){let i=g();e(0,"p-button",44),d("onClick",function(){b(i);let m=_();return C(m.editEntry())}),r()}}function he(l,t){if(l&1){let i=g();e(0,"p-button",45),d("onClick",function(){b(i);let m=_();return C(m.saveVehicle())}),r()}}var ne=class l{constructor(t,i,n,m){this.servicesService=t;this.router=i;this.vehiclesService=n;this.entryService=m;this.tiposVehiculo=[{tipo:"Moto"},{tipo:"Autom\xF3vil"},{tipo:"Camioneta"},{tipo:"Cami\xF3n"},{tipo:"Furgoneta"},{tipo:"Pickup"},{tipo:"Bus"},{tipo:"Buseta"},{tipo:"Ambulancia"}],this.servicesService.getAllServices().subscribe({next:a=>{this.servicios=a,this.filterAsignedServices()},error:a=>{console.error("Error obteniendo servicios:",a)}}),this.vehiclesService.getAll().subscribe(a=>{this.vehicles=a})}flagEdit=!1;tiposVehiculo=[];servicios=[];selectedService;selectedServices=[];totalToPay=0;vehicles=[];vehicles_filtered=[];tipo_selected;entryToEdit;entries=[];vehicleForm=new T({placa:new u(null,f.required),marca:new u("",f.required),linea:new u("",f.required),tipo:new u(null,f.required),clave:new u(""),nombre_prop:new u("",f.required),contacto:new u("",f.required)});serviceForm=new T({servicio:new u(null,f.required)});ngOnInit(){this.entryService.getAll().subscribe(t=>{this.entries=t}),this.entryToEdit=this.entryService.getEntrySelected(),this.entryToEdit!==null&&(this.vehicleForm.patchValue(this.entryToEdit.Vehicle),this.flagEdit=!0,this.vehicleForm.get("placa")?.disable())}filterAsignedServices(){this.entryToEdit!==null&&(this.selectedServices=this.servicios.filter(t=>this.entryToEdit?.AsignedServices.some(i=>i.id_servicio===t.id_servicio)))}filterVehicle(t){let i=typeof t.value=="string"?t.value.toUpperCase():"";if(this.vehicleForm.get("placa")?.setValue(i,{emitEvent:!1}),typeof t.value=="object"&&t.value.placa)if(this.entries.some(a=>a.estado==="EN PROCESO"&&a.placa===t.value.placa))s.default.fire({position:"center",icon:"error",title:"El veh\xEDculo ya se encuentra en proceso",text:"Registre un nuevo veh\xEDculo",showConfirmButton:!1,timer:1500});else{this.vehicleForm.patchValue(t.value),this.tipo_selected=t.value.tipo;return}let n=i.trim();n.length>1?this.vehicles_filtered=this.vehicles.filter(m=>{let a=m.placa.toLowerCase(),le=n.toLowerCase();return a.startsWith(le)}):this.vehicles_filtered=[],n===""&&this.vehicleForm.reset()}editEntry(){if(this.vehicleForm.invalid)s.default.fire({position:"center",icon:"error",title:"Informacion incompleta",text:"Debe ingresar la informaci\xF3n en todos los campos",showConfirmButton:!1,timer:1500});else if(this.selectedServices.length===0)s.default.fire({position:"center",icon:"error",title:"Informacion incompleta",text:"Debe asignar por lo menos 1 servicio",showConfirmButton:!1,timer:1500});else{this.vehicleForm.get("placa")?.enable();let t=this.vehicleForm.value;this.entryService.editEntry(t,this.selectedServices,this.entryToEdit.id_ingreso).subscribe(i=>{s.default.fire({position:"center",icon:"success",title:"Ingreso actualizado",showConfirmButton:!1,timer:1500}),this.entryService.setEntry(null),this.serviceForm.reset(),this.vehicleForm.reset(),this.selectedServices.length=0,this.router.navigate(["vehicles"])},i=>{s.default.fire({position:"center",icon:"error",title:"Ocurri\xF3 un error",text:"No fue posible actualizar el ingreso",showConfirmButton:!1,timer:1500})})}}saveVehicle(){if(this.vehicleForm.invalid)s.default.fire({position:"center",icon:"error",title:"Informaci\xF3n incompleta",text:"Debe ingresar la informaci\xF3n en todos los campos",showConfirmButton:!1,timer:1500});else if(this.selectedServices.length===0)s.default.fire({position:"center",icon:"error",title:"Informaci\xF3n incompleta",text:"Debe asignar al menos un servicio",showConfirmButton:!1,timer:1500});else{let t=this.vehicleForm.value;this.entryService.saveEntry(t,this.selectedServices).subscribe(i=>{s.default.fire({position:"center",icon:"success",title:"Ingreso registrado",showConfirmButton:!1,timer:1500}),this.serviceForm.reset(),this.vehicleForm.reset(),this.selectedServices.length=0,this.router.navigate(["vehicles"])},i=>{s.default.fire({position:"center",icon:"error",title:"Ocurri\xF3 un error",text:"No fue posible registrar el ingreso",showConfirmButton:!1,timer:1500})})}}addService(){let t=this.serviceForm.get("servicio")?.value;t&&!this.selectedServices.some(i=>i.id_servicio===t.id_servicio)?(this.selectedServices.push(t),this.serviceForm.reset()):s.default.fire({position:"center",icon:"error",title:"Ya esta agregado",text:"Debe registrar un servicio distinto",showConfirmButton:!1,timer:1500})}eliminarServicio(t){s.default.fire({title:"\xBFEst\xE1 seguro?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#32cd32",cancelButtonColor:"#d33",confirmButtonText:"Si",cancelButtonText:"No"}).then(i=>{i.isConfirmed&&(this.selectedServices=this.selectedServices.filter(n=>n.id_servicio!==t),s.default.fire({showConfirmButton:!1,title:"Servicio eliminado",icon:"error",timer:1500}))})}getTotalServicios(){return this.selectedServices.reduce((t,i)=>t+(i.valor_servicio||0),0)}cancelar(){s.default.fire({title:"\xBFEst\xE1 seguro?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#32cd32",cancelButtonColor:"#d33",confirmButtonText:"Si",cancelButtonText:"No"}).then(t=>{t.isConfirmed&&(s.default.fire({showConfirmButton:!1,title:"Proceso cancelado",icon:"error",timer:1500}),this.entryService.setEntry(null),this.serviceForm.reset(),this.vehicleForm.reset(),this.selectedServices.length=0,this.router.navigate(["vehicles"]))})}static \u0275fac=function(i){return new(i||l)(h(re),h(k),h(x),h(oe))};static \u0275cmp=A({type:l,selectors:[["app-entry"]],decls:71,vars:13,consts:[[1,"flex","flex-col","justify-center","px-6","py-12","w-screen"],[1,"flex","items-center","justify-center"],[1,"text-white","text-4xl","font-bold","text-center"],[1,"mt-5","sm:mx-auto","sm:w-full","sm:max-w-sm"],[1,"text-white","text-2xl"],[1,"border-2","rounded-xl","border-white","p-4"],[1,"space-y-3",3,"formGroup"],[1,"grid","grid-cols-2","gap-2"],["variant","in"],["optionLabel","placa","formControlName","placa",1,"w-full",3,"onChange","options","editable"],["for","placa"],["pInputText","","id","marca","autocomplete","on","formControlName","marca",1,"w-full"],["for","marca"],["pInputText","","id","linea","autocomplete","on","formControlName","linea",1,"w-full"],["for","linea"],["formControlName","tipo","optionLabel","tipo","optionValue","tipo",1,"w-full",3,"options"],["for","tipo"],["pInputText","","id","propietario","autocomplete","off","formControlName","nombre_prop","oninput","this.value = this.value.replace(/[^a-zA-Z\xE1\xE9\xED\xF3\xFA\xC1\xC9\xCD\xD3\xDA\xF1\xD1\\s]/g, '')",1,"w-full"],["for","propietario"],["pInputText","","id","contacto","autocomplete","off","formControlName","contacto","maxlength","10","oninput","this.value = this.value.replace(/[^0-9]/g, '')",1,"w-full"],["for","contacto"],["pInputText","","id","clave","autocomplete","off","formControlName","clave",1,"w-full"],["for","clave"],["formControlName","servicio","optionLabel","nombre_servicio",1,"w-full",3,"options"],["for","servicio"],[1,"flex","justify-center"],["severity","info","label","ASIGNAR",3,"onClick"],[1,"mt-5","h-[400px]","bg-white","rounded-lg","p-4","flex","flex-col","items-center","text-center"],[1,"text-xl","font-bold","mb-4","italic","text-gray-400"],[1,"w-full","overflow-auto"],["stripedRows","","scrollHeight","300px",3,"value","scrollable"],["pTemplate","header"],["pTemplate","body"],[1,"text-l","font-bold","mb-4","italic","text-white"],[1,"flex","justify-center","gap-4"],["severity","success","label","EDITAR"],["severity","success","label","GUARDAR"],["severity","danger","label","CANCELAR",3,"onClick"],[2,"color","cornflowerblue","width","30%"],[2,"color","cornflowerblue","width","40%"],[2,"color","cornflowerblue","width","10%"],[1,"w-full","flex","justify-center"],["title","eliminar",1,"transition-all","duration-300","active:brightness-80",3,"click"],["src","iconos-botones/eliminar.png","alt","",1,"w-[30px]"],["severity","success","label","EDITAR",3,"onClick"],["severity","success","label","GUARDAR",3,"onClick"]],template:function(i,n){i&1&&(e(0,"div",0)(1,"div",1),E(2,pe,2,0,"h1",2)(3,ue,2,0,"h1",2),r(),e(4,"div",3)(5,"h2",4),o(6,"Informaci\xF3n del veh\xEDculo"),r(),e(7,"div",5)(8,"form",6)(9,"div",7)(10,"div")(11,"p-floatlabel",8)(12,"p-select",9),d("onChange",function(a){return n.filterVehicle(a)}),r(),e(13,"label",10),o(14,"Placa"),r()()(),e(15,"div")(16,"p-floatlabel",8),p(17,"input",11),e(18,"label",12),o(19,"Marca"),r()()(),e(20,"div")(21,"p-floatlabel",8),p(22,"input",13),e(23,"label",14),o(24,"L\xEDnea"),r()()(),e(25,"div")(26,"p-floatlabel",8),p(27,"p-select",15),e(28,"label",16),o(29,"Tipo"),r()()(),e(30,"div")(31,"p-floatlabel",8),p(32,"input",17),e(33,"label",18),o(34,"Propietario"),r()()(),e(35,"div")(36,"p-floatlabel",8),p(37,"input",19),e(38,"label",20),o(39,"Contacto"),r()()(),e(40,"div")(41,"p-floatlabel",8),p(42,"input",21),e(43,"label",22),o(44,"Clave"),r()()()()()()(),e(45,"div",3)(46,"h2",4),o(47,"Asignaci\xF3n de servicio"),r(),e(48,"div",5)(49,"form",6)(50,"div")(51,"p-floatlabel",8),p(52,"p-select",23),e(53,"label",24),o(54,"Servicios"),r()()(),e(55,"div",25)(56,"p-button",26),d("onClick",function(){return n.addService()}),r()()()()(),e(57,"div",27)(58,"h2",28),o(59," LISTA DE SERVICIOS ASIGNADOS "),r(),e(60,"div",29)(61,"p-table",30),E(62,fe,11,0,"ng-template",31)(63,ve,14,6,"ng-template",32),r()()(),e(64,"h2",33),o(65),w(66,"currency"),r(),e(67,"div",34),E(68,de,1,0,"p-button",35)(69,he,1,0,"p-button",36),e(70,"p-button",37),d("onClick",function(){return n.cancelar()}),r()()()),i&2&&(c(2),y(n.flagEdit?2:3),c(6),v("formGroup",n.vehicleForm),c(4),v("options",n.vehicles_filtered)("editable",!0),c(15),v("options",n.tiposVehiculo),c(22),v("formGroup",n.serviceForm),c(3),v("options",n.servicios),c(9),v("value",n.selectedServices)("scrollable",!0),c(4),B(" Total a pagar: ",I(66,11,n.getTotalServicios())," "),c(3),y(n.flagEdit?68:69))},dependencies:[Z,H,P,q,U,W,$,z,G,j,M,Q,K,J,L,ee,X,ie,te,N,D,Y],encapsulation:2})};export{ne as EntryComponent};
