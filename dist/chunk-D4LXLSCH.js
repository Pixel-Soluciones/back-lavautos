import{a as ee}from"./chunk-6HSLBKDU.js";import{a as j}from"./chunk-GN6EZ355.js";import{a as X}from"./chunk-ZMK2ANYN.js";import"./chunk-VKXV5I3W.js";import{a as H,b as W,c as J,d as K,e as Q}from"./chunk-TX7LC2PY.js";import{a as Z}from"./chunk-EHGHV7SA.js";import{a as Y}from"./chunk-UE6GWZRO.js";import"./chunk-SXKB25RG.js";import{A as O,B as $,C as z,D as U,k as P,l as V,n as R,o as m,q as D,r as M,s as b,t as p,v as q,w as G,x as L}from"./chunk-EKOSEFZP.js";import"./chunk-U3QUSVWF.js";import{Z as N}from"./chunk-74RUH4UK.js";import{a as oe}from"./chunk-37JVPQS2.js";import{h as B}from"./chunk-BXPCUMYM.js";import{Ac as k,Bc as A,Cb as n,Db as y,Eb as F,Ga as s,Ha as S,Pa as E,Tb as _,Ub as w,Va as I,bb as d,e as ie,ha as x,ia as C,lb as e,mb as i,nb as c,rb as T,sb as v,tb as g}from"./chunk-SEJLVJPR.js";var u=ie(oe());function re(f,t){f&1&&(e(0,"tr")(1,"th",42),n(2,"Servicio"),i(),e(3,"th",43),n(4,"Valor"),i(),e(5,"th",42),n(6,"Trabajador"),i(),e(7,"th",43),n(8,"Opci\xF3n"),i()())}function ne(f,t){if(f&1){let r=T();e(0,"tr")(1,"td"),n(2),i(),e(3,"td"),n(4),_(5,"currency"),i(),e(6,"td")(7,"form",3)(8,"p-floatlabel",44)(9,"p-select",45),v("onChange",function(a){let l=x(r).$implicit,h=g();return C(h.setEmployee(a,l.id_servicio))}),i(),e(10,"label",46),n(11,"Trabajador"),i()()()(),e(12,"td")(13,"div",47)(14,"button",48),v("click",function(){let a=x(r).$implicit,l=g();return C(l.eliminarServicio(a.id_servicio))}),c(15,"img",49),i()()()()}if(f&2){let r=t.$implicit,o=g();s(2),y(r.nombre_servicio),s(2),y(w(5,6,r.valor_servicio)),s(3),d("formGroup",o.employeeForm),s(2),d("options",o.employees)("editable",!0)("appendTo","body")}}var te=class f{constructor(t,r,o,a){this.entryService=t;this.servicesService=r;this.employeeService=o;this.router=a;this.tiposVehiculo=[{tipo:"Moto"},{tipo:"Autom\xF3vil"},{tipo:"Camioneta"},{tipo:"Cami\xF3n"},{tipo:"Furgoneta"},{tipo:"Pickup"},{tipo:"Bus"},{tipo:"Buseta"},{tipo:"Ambulancia"}],this.entryService.getAll().subscribe(l=>{this.entriesOfDay=l}),this.servicesService.getAllServices().subscribe(l=>{this.services=l}),this.employeeService.getAll().subscribe(l=>{this.employees=l})}entrie;entriesOfDay=[];tiposVehiculo=[];selectedServices=[];services=[];entries_filtered=[];employees=[];flagUnknown=!0;tipoPago;vehicleForm=new b({placa:new p(null,m.required),marca:new p({value:"",disabled:!0},m.required),linea:new p({value:"",disabled:!0},m.required),tipo:new p({value:null,disabled:!0},m.required),clave:new p({value:"",disabled:!0},m.required),nombre_prop:new p({value:"",disabled:!0},m.required),contacto:new p({value:"",disabled:!0},m.required)});employeeForm=new b({employee:new p(null,m.required)});tipoPagoForm=new b({tipoPago:new p("",m.required)});ngOnInit(){this.entrie=this.entryService.getEntrySelected(),this.entrie!==null&&(this.vehicleForm.patchValue(this.entrie.Vehicle),console.log(this.entrie),this.servicesService.getAllServices().subscribe({next:t=>{this.services=t,this.selectedServices=this.services.filter(r=>this.entrie?.AsignedServices.some(o=>o.id_servicio===r.id_servicio)),console.log("Servicios seleccionados:",this.selectedServices)},error:t=>{console.error("Error obteniendo servicios:",t)}}))}veryfyEmployees(){return this.entrie?.AsignedServices.every(t=>t.id_trabajador!==null)??!1}saveCheckout(){this.entrie?this.veryfyEmployees()===!1?u.default.fire({position:"center",icon:"error",title:"Informacion incompleta",text:"Asigne un trabajador a cada servicio",showConfirmButton:!1,timer:1500}):this.tipoPagoForm.invalid?u.default.fire({position:"center",icon:"error",title:"Informacion incompleta",text:"Seleccione el tipo de pago",showConfirmButton:!1,timer:1500}):this.entrie&&this.tipoPagoForm.valid&&(this.entrie.tipo_pago=this.tipoPagoForm.get("tipoPago")?.value??"",this.entryService.registerCheckout(this.entrie).subscribe(t=>{u.default.fire({position:"center",icon:"success",title:"Salida registrada",showConfirmButton:!1,timer:1500}),this.entryService.setEntry(null),this.employeeForm.reset(),this.vehicleForm.reset(),this.tipoPagoForm.reset(),this.selectedServices.length=0,this.router.navigate(["vehicles"])})):u.default.fire({position:"center",icon:"error",title:"Informacion incompleta",text:"Ingrese una placa",showConfirmButton:!1,timer:1500})}setEmployee(t,r){console.log("Trabajador",t),console.log("id_servicio",r),this.entrie?.AsignedServices.forEach(o=>{o.id_servicio===r&&(o.id_trabajador=t.value.cedula)}),console.log(this.entrie?.AsignedServices)}filterEntry(t){if(t.value.placa&&(t.value.estado==="TERMINADO"&&(u.default.fire({position:"center",icon:"error",title:"Salida registrada",text:"El veh\xEDculo ya report\xF3 salida del establecimiento",showConfirmButton:!1,timer:1500}),this.vehicleForm.reset()),t.value.estado==="EN PROCESO")){this.vehicleForm.patchValue(t.value.Vehicle),this.entrie=t.value,this.selectedServices=this.services.filter(o=>t.value.AsignedServices.some(a=>a.id_servicio===o.id_servicio));return}let r=typeof t.value=="string"?t.value.trim():"";r&&r.length>1&&(this.entries_filtered=this.entriesOfDay.filter(o=>{let a=o.placa.replace(/[a-zA-Z]/g,h=>h.toLowerCase()),l=r.replace(/[a-zA-Z]/g,h=>h.toLowerCase());return a.startsWith(l)})),r===""&&(this.vehicleForm.reset(),this.selectedServices.length=0)}eliminarServicio(t){u.default.fire({title:"\xBFEst\xE1 seguro?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#32cd32",cancelButtonColor:"#d33",confirmButtonText:"Si",cancelButtonText:"No"}).then(r=>{r.isConfirmed&&(this.selectedServices=this.selectedServices.filter(o=>o.id_servicio!==t),u.default.fire({showConfirmButton:!1,title:"Servicio eliminado",icon:"error",timer:1500}))})}getTotalServicios(){return this.selectedServices.reduce((t,r)=>t+(r.valor_servicio||0),0)}cancelar(){u.default.fire({title:"\xBFEst\xE1 seguro?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#32cd32",cancelButtonColor:"#d33",confirmButtonText:"Si",cancelButtonText:"No"}).then(t=>{t.isConfirmed&&(u.default.fire({showConfirmButton:!1,title:"Registro cancelado",icon:"error",timer:1500}),this.entryService.setEntry(null),this.employeeForm.reset(),this.vehicleForm.reset(),this.tipoPagoForm.reset(),this.selectedServices.length=0,this.router.navigate(["vehicles"]))})}static \u0275fac=function(r){return new(r||f)(S(ee),S(X),S(Y),S(B))};static \u0275cmp=E({type:f,selectors:[["app-checkout"]],decls:69,vars:10,consts:[[1,"flex","flex-col","justify-center","px-6","py-12","w-screen"],[1,"flex","items-center","justify-center"],[1,"text-white","text-4xl","font-bold","text-center"],[1,"space-y-3",3,"formGroup"],[1,"mt-5","sm:mx-auto","sm:w-full","sm:max-w-sm","flex","justify-center"],["variant","in"],["optionLabel","placa","formControlName","placa",1,"w-full","uppercase",3,"onChange","options","editable"],["for","placa"],[1,"mt-5","sm:mx-auto","sm:w-full","sm:max-w-sm"],[1,"text-white","text-2xl"],[1,"border-2","rounded-xl","border-white","p-4"],[1,"grid","grid-cols-2","gap-2"],["pInputText","","id","marca","autocomplete","on","formControlName","marca",1,"w-full"],["for","marca"],["pInputText","","id","linea","autocomplete","on","formControlName","linea",1,"w-full"],["for","linea"],["formControlName","tipo","optionLabel","tipo","optionValue","tipo",1,"w-full",3,"options"],["for","tipo"],["pInputText","","id","propietario","autocomplete","off","formControlName","nombre_prop",1,"w-full"],["for","propietario"],["pInputText","","id","contacto","autocomplete","off","formControlName","contacto",1,"w-full"],["for","contacto"],["pInputText","","id","clave","autocomplete","off","formControlName","clave",1,"w-full"],["for","clave"],[1,"mt-5","h-[400px]","bg-white","rounded-lg","p-4","flex","flex-col","items-center","text-center"],[1,"text-xl","font-bold","mb-4","italic","text-gray-400"],[1,"w-full","overflow-auto"],["stripedRows","","scrollHeight","300px",3,"value","scrollable"],["pTemplate","header"],["pTemplate","body"],[1,"text-l","font-bold","mb-4","italic","text-white"],[3,"formGroup"],[1,"card","flex","justify-center","mt-3"],[1,"flex","flex-wrap","gap-10"],[1,"flex","items-center"],["name","tipoPago","formControlName","tipoPago","value","Efectivo","inputId","tipo1"],["for","tipo1",1,"ml-2","text-white"],["name","tipoPago","formControlName","tipoPago","value","Transferencia","inputId","tipo2"],["for","tipo2",1,"ml-2","text-white"],[1,"flex","justify-center","gap-4","mt-5"],["severity","success","label","GUARDAR",3,"click"],["severity","danger","label","CANCELAR",3,"click"],[2,"color","cornflowerblue","width","30%"],[2,"color","cornflowerblue","width","20%"],["variant","in",1,"w-full"],["formControlName","employee","optionLabel","nombre",1,"w-full","!min-w-[120px]",3,"onChange","options","editable","appendTo"],["for","tipo",1,"text-sm","whitespace-nowrap","overflow-hidden","text-ellipsis"],[1,"w-full","flex","justify-center"],["title","eliminar",1,"transition-all","duration-300","active:brightness-80",3,"click"],["src","iconos-botones/eliminar.png","alt","",1,"w-[30px]"]],template:function(r,o){r&1&&(e(0,"div",0)(1,"div",1)(2,"h1",2),n(3,"REGISTRAR SALIDA"),i()(),e(4,"form",3)(5,"div",4)(6,"p-floatlabel",5)(7,"p-select",6),v("onChange",function(l){return o.filterEntry(l)}),i(),e(8,"label",7),n(9,"Placa"),i()()(),e(10,"div",8)(11,"h2",9),n(12,"Informaci\xF3n del veh\xEDculo"),i(),e(13,"div",10)(14,"div",11)(15,"div")(16,"p-floatlabel",5),c(17,"input",12),e(18,"label",13),n(19,"Marca"),i()()(),e(20,"div")(21,"p-floatlabel",5),c(22,"input",14),e(23,"label",15),n(24,"L\xEDnea"),i()()(),e(25,"div")(26,"p-floatlabel",5),c(27,"p-select",16),e(28,"label",17),n(29,"Tipo"),i()()(),e(30,"div")(31,"p-floatlabel",5),c(32,"input",18),e(33,"label",19),n(34,"Propietario"),i()()(),e(35,"div")(36,"p-floatlabel",5),c(37,"input",20),e(38,"label",21),n(39,"Contacto"),i()()(),e(40,"div")(41,"p-floatlabel",5),c(42,"input",22),e(43,"label",23),n(44,"Clave"),i()()()()()()(),e(45,"div",24)(46,"h2",25),n(47," LISTA DE SERVICIOS ASIGNADOS "),i(),e(48,"div",26)(49,"p-table",27),I(50,re,9,0,"ng-template",28)(51,ne,16,8,"ng-template",29),i()()(),e(52,"h2",30),n(53),_(54,"currency"),i(),e(55,"form",31)(56,"div",32)(57,"div",33)(58,"div",34),c(59,"p-radiobutton",35),e(60,"label",36),n(61,"Efectivo"),i()(),e(62,"div",34),c(63,"p-radiobutton",37),e(64,"label",38),n(65,"Transferencia"),i()()()()(),e(66,"div",39)(67,"p-button",40),v("click",function(){return o.saveCheckout()}),i(),e(68,"p-button",41),v("click",function(){return o.cancelar()}),i()()()),r&2&&(s(4),d("formGroup",o.vehicleForm),s(3),d("options",o.entries_filtered)("editable",!0),s(20),d("options",o.tiposVehiculo),s(22),d("value",o.selectedServices)("scrollable",!0),s(4),F(" Total a pagar: ",w(54,8,o.getTotalServicios())," "),s(2),d("formGroup",o.tipoPagoForm))},dependencies:[$,q,R,D,M,G,L,O,Z,H,Q,K,N,V,P,U,z,j,W,A,k,J],encapsulation:2})};export{te as CheckoutComponent};
