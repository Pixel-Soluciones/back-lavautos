import{a as de}from"./chunk-KIOSF3XI.js";import{a as ee}from"./chunk-VKXV5I3W.js";import{a as me}from"./chunk-OPDICZTB.js";import{d as pe,e as se}from"./chunk-7TLLC36Y.js";import{a as le}from"./chunk-YEA552Y6.js";import{f as ce}from"./chunk-O3WCHT2C.js";import{G as fe,k as ne,l as ie,q as oe,u as re,z as ae}from"./chunk-P3IO33T2.js";import"./chunk-U3QUSVWF.js";import{Z as te}from"./chunk-2SOGP6GP.js";import{a as W,h as Z}from"./chunk-B5AEI34L.js";import{Aa as a,Ja as w,Nb as C,Ob as z,P as O,Pa as m,Pb as T,Qb as X,V as v,Xa as s,Yb as E,ab as $,ba as u,bb as M,ca as f,db as R,eb as I,fb as o,gb as r,hb as k,ia as U,ib as d,jb as _,lb as y,mb as x,mc as D,nb as c,nc as Y,oa as b,oc as G,pc as J,qb as B,sc as K,tc as Q,uc as A,vb as H,vc as N,wb as l,xb as S,ya as q,yb as h}from"./chunk-S4YP6WBW.js";import{e as ue}from"./chunk-C6Q5SG76.js";function he(t,n){if(t&1&&(o(0,"th",7),l(1),C(2,"titlecase"),r()),t&2){let e=n.$implicit;a(),h(" ",z(2,1,e.value)," ")}}function Ce(t,n){t&1&&(o(0,"th"),l(1," Opciones "),r())}function ve(t,n){if(t&1&&(o(0,"tr"),R(1,he,3,3,"th",7,M),m(3,Ce,2,0,"th",8),r()),t&2){let e=c();a(),I(e.cols),a(2),s("ngIf",e.actions.length>0)}}function be(t,n){if(t&1&&(d(0),o(1,"td"),l(2),C(3,"date"),r(),_()),t&2){let e=c().$implicit,i=c().$implicit;a(2),h(" ",T(3,1,i[e.key],"dd/MM/yyyy")," ")}}function ye(t,n){if(t&1&&(d(0),o(1,"td"),l(2),C(3,"currency"),r(),_()),t&2){let e=c().$implicit,i=c().$implicit;a(2),h(" ",T(3,1,i[e.key],"USD")," ")}}function Se(t,n){if(t&1&&(d(0),o(1,"td"),l(2),r(),_()),t&2){let e=c().$implicit,i=c().$implicit;a(2),h(" ",i[e.key]," ")}}function Te(t,n){if(t&1&&(d(0,9),m(1,be,4,4,"ng-container",11)(2,ye,4,4,"ng-container",11)(3,Se,3,1,"ng-container",12),_()),t&2){let e=n.$implicit;s("ngSwitch",e.key),a(),s("ngSwitchCase","fecha"),a(),s("ngSwitchCase","valor")}}function Ee(t,n){if(t&1){let e=y();o(0,"button",15),x("click",function(){u(e);let p=c().$implicit,g=c(2).$implicit,F=c();return f(F.onAction(p.action,g))}),k(1,"img",16),r()}if(t&2){let e=c().$implicit;B("title",e.title),a(),B("src",e.icon,q)}}function we(t,n){if(t&1&&m(0,Ee,2,2,"button",14),t&2){let e=n.$implicit,i=c(2).$implicit;s("ngIf",!(e.action==="Checkout"&&i.estado!=="EN PROCESO"))}}function Me(t,n){if(t&1&&(d(0),R(1,we,1,1,"button",13,M),_()),t&2){let e=c(2);a(),I(e.actions)}}function Re(t,n){if(t&1&&(o(0,"tr"),R(1,Te,4,3,"ng-container",9,M),o(3,"td")(4,"div",10),m(5,Me,3,0,"ng-container",8),r()()()),t&2){let e=c();a(),I(e.cols),a(4),s("ngIf",e.actions.length>0)}}function Ie(t,n){t&1&&(o(0,"tr")(1,"td",17),l(2," No hay registros disponibles "),r()())}var P=class t{title="";cols=[];dataSource=[];actions=[];action=new U;onAction(n,e){this.action.emit({action:n,row:e})}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=w({type:t,selectors:[["table-report"]],inputs:{title:"title",cols:"cols",dataSource:"dataSource",actions:"actions"},outputs:{action:"action"},decls:8,vars:3,consts:[[1,"mt-5","h-[500px]","bg-white","rounded-lg","p-4","flex","flex-col","items-center"],[1,"text-xl","font-bold","mb-4","italic","text-gray-400"],[1,"w-full","overflow-auto"],["stripedRows","","scrollHeight","400px",3,"value","scrollable"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"text-center"],[4,"ngIf"],[3,"ngSwitch"],[1,"w-full","contents"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],[1,"transition-all","duration-300","active:brightness-80",3,"title"],["class","transition-all duration-300 active:brightness-80",3,"title","click",4,"ngIf"],[1,"transition-all","duration-300","active:brightness-80",3,"click","title"],["alt","",1,"w-[30px]","ml-1",3,"src"],["colspan","100%",1,"text-center","py-4","text-gray-500"]],template:function(e,i){e&1&&(o(0,"div",0)(1,"h2",1),l(2),r(),o(3,"div",2)(4,"p-table",3),m(5,ve,4,1,"ng-template",4)(6,Re,6,1,"ng-template",5)(7,Ie,3,0,"ng-template",6),r()()()),e&2&&(a(2),h(" ",i.title," "),a(2),s("value",i.dataSource)("scrollable",!0))},dependencies:[N,D,Y,G,J,K,A,Q,se,pe,te],styles:["[_nghost-%COMP%]   th[_ngcontent-%COMP%]{color:#6495ed}"]})};var j=class t{#e=v(W);url=ee.API_URL;get(n){return this.#e.post(`${this.url}/reports/monthly`,n)}static \u0275fac=function(e){return new(e||t)};static \u0275prov=O({token:t,factory:t.\u0275fac,providedIn:"root"})};var V=ue(fe());function ke(t,n){t&1&&(d(0),o(1,"p",13),l(2,"Cargando datos..."),r(),_())}function De(t,n){if(t&1&&(o(0,"div",17)(1,"div",18)(2,"div",19)(3,"div",20)(4,"p"),l(5,"Total: "),o(6,"span",21),l(7),C(8,"currency"),r()(),o(9,"p"),l(10,"Trabajador del mes: "),k(11,"span",21),l(12),r(),o(13,"p"),l(14,"Servicio m\xE1s solicitado: "),o(15,"span",21),l(16),r()(),o(17,"p"),l(18,"Cliente destacado: "),o(19,"span",21),l(20),r()()()()()()),t&2){let e=c(3);a(7),S(T(8,4,e.total(),"USD")),a(5),S(e.trabajadorDelMes()),a(4),S(e.servicioMasSolicitado()),a(4),S(e.clienteDelMes())}}function Ae(t,n){if(t&1){let e=y();o(0,"table-report",16),x("action",function(p){u(e);let g=c(2);return f(g.handleAction(p))}),r(),m(1,De,21,7,"div",17)}if(t&2){let e=c(2);s("title","Lista de veh\xEDculos")("cols",e.cols())("dataSource",e.services()),a(),$(e.services().length>0?1:-1)}}function Ne(t,n){t&1&&(o(0,"div",15)(1,"p",22),l(2,"Seleccione una fecha para continuar"),r()())}function Pe(t,n){if(t&1&&(o(0,"div",14),m(1,Ae,2,4)(2,Ne,3,0,"div",15),r()),t&2){let e=c();a(),$(e.services().length>0?1:2)}}var L=class t{#e=v(Z);#t=v(j);isLoading=b(!1);date=b(null);cols=b(me("monthlyReport"));services=b([]);total=E(()=>this.services().reduce((n,e)=>n+e.valor,0));trabajadorDelMes=E(()=>{let n=new Map;return this.services().forEach(e=>{n.set(e.trabajador,(n.get(e.trabajador)||0)+1)}),Array.from(n.entries()).reduce((e,[i,p])=>p>e.count?{value:i,count:p}:e,{value:"",count:0}).value});clienteDelMes=E(()=>{let n=new Map;return this.services().forEach(e=>{n.set(e.placa,(n.get(e.placa)||0)+1)}),Array.from(n.entries()).reduce((e,[i,p])=>p>e.count?{value:i,count:p}:e,{value:"",count:0}).value});servicioMasSolicitado=E(()=>{let n=new Map;return this.services().forEach(e=>{n.set(e.servicio,(n.get(e.servicio)||0)+1)}),Array.from(n.entries()).reduce((e,[i,p])=>p>e.count?{value:i,count:p}:e,{value:"",count:0}).value});selectedMonth(n){if(!n)return;this.isLoading.set(!0),this.date.set(n);let e=this.formatDate(n);this.#t.get(e).subscribe({next:i=>{if(i.length==0){V.default.fire({title:"Error",text:"No existe informaci\xF3n en el mes seleccionado",icon:"error",confirmButtonText:"Aceptar"}),this.isLoading.set(!1),this.services.set([]);return}this.services.set(i),this.isLoading.set(!1)},error:()=>{this.isLoading.set(!1),V.default.fire({title:"Error",text:"No se pudo obtener el reporte",icon:"error",confirmButtonText:"Aceptar"})}})}formatDate(n){return{month:n.getMonth()+1,year:n.getFullYear()}}exportReport(){if(this.services().length===0)return;let n=[this.cols().map(e=>e.key)];this.services().forEach(e=>{n.push(this.cols().map(i=>e[i.key]))}),console.log(n),de(n,"M")}salir(){this.#e.navigate(["reports"])}handleAction(n){}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=w({type:t,selectors:[["app-reports-month"]],decls:16,vars:7,consts:[["content",""],[1,"flex","flex-col","justify-center","px-6","py-12","w-screen"],[1,"flex","items-center","justify-center"],[1,"text-white","text-4xl","font-bold","text-center"],[1,"mt-5","flex","justify-center","items-center","w-full"],[1,"w-full","max-w-sm"],["variant","in"],["id","monthPicker","view","month","dateFormat","mm/yy",3,"ngModelChange","ngModel","readonlyInput","iconDisplay","showIcon"],["for","monthPicker"],[4,"ngIf","ngIfElse"],[1,"flex","justify-center","gap-2","mt-5"],["severity","success","label","EXPORTAR",3,"onClick","disabled"],["severity","danger","label","CANCELAR",3,"onClick"],[1,"text-white","text-center"],[1,"container","mx-auto","px-4","max-w-6x"],[1,"flex","justify-center","items-center","mt-4"],[3,"action","title","cols","dataSource"],[1,"mb-4"],[1,"p-6"],[1,"grid","grid-cols-1","md:grid-cols-2","text-white","text-l","mb-4","italic"],[1,"text-lg"],[1,"font-bold"],[1,"text-white","text-l","italic"]],template:function(e,i){if(e&1){let p=y();o(0,"div",1)(1,"div",2)(2,"h1",3),l(3," REPORTE MENSUAL "),r()(),o(4,"div",4)(5,"div",5)(6,"p-floatlabel",6)(7,"p-datepicker",7),x("ngModelChange",function(F){return u(p),f(i.selectedMonth(F))}),r(),o(8,"label",8),l(9,"Seleccione el mes"),r()()()(),m(10,ke,3,0,"ng-container",9)(11,Pe,3,1,"ng-template",null,0,X),o(13,"div",10)(14,"p-button",11),x("onClick",function(){return u(p),f(i.exportReport())}),r(),o(15,"p-button",12),x("onClick",function(){return u(p),f(i.salir())}),r()()()}if(e&2){let p=H(12);a(7),s("ngModel",i.date())("readonlyInput",!0)("iconDisplay","input")("showIcon",!0),a(3),s("ngIf",i.isLoading())("ngIfElse",p),a(4),s("disabled",i.services().length==0)}},dependencies:[le,ce,ae,oe,re,ie,ne,P,N,D,A],encapsulation:2})};export{L as default};
