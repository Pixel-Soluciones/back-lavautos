import{a as re}from"./chunk-2GRF4W6Z.js";import{a as L}from"./chunk-E3GALLMJ.js";import{a as ie}from"./chunk-O4RVLNNV.js";import{a as j}from"./chunk-VKXV5I3W.js";import{a as X,b as Z,d as ee,e as te}from"./chunk-7TLLC36Y.js";import{a as Q}from"./chunk-YEA552Y6.js";import"./chunk-O3WCHT2C.js";import{A as Y,B as J,C as K,G as se,k as O,l as G,n as q,o as f,q as P,r as U,s as T,t as u,v as H,w as $,x as z,z as W}from"./chunk-P3IO33T2.js";import"./chunk-U3QUSVWF.js";import{Z as M}from"./chunk-2SOGP6GP.js";import{a as R,h as k}from"./chunk-B5AEI34L.js";import{Aa as s,Ba as h,Ja as B,Nb as w,Ob as I,P as V,Pa as g,U as F,Xa as d,ab as y,ba as C,ca as b,fb as e,gb as r,hb as p,lb as _,mb as v,nb as E,uc as N,vc as D,wb as o,xb as S,yb as A}from"./chunk-S4YP6WBW.js";import{e as le}from"./chunk-C6Q5SG76.js";var c=le(se());var x=class l{constructor(t){this.http=t}url=j.API_URL;getAll(){return this.http.get(`${this.url}/vehicles`)}saveVehicle(t){return this.http.post(`${this.url}/vehicles/create`,t)}static \u0275fac=function(i){return new(i||l)(F(R))};static \u0275prov=V({token:l,factory:l.\u0275fac,providedIn:"root"})};function me(l,t){l&1&&(e(0,"h1",2),o(1,"MODIFICAR INGRESO"),r())}function pe(l,t){l&1&&(e(0,"h1",2),o(1,"NUEVO INGRESO"),r())}function ue(l,t){l&1&&(e(0,"tr")(1,"th",38),o(2,"Servicio"),r(),e(3,"th",39),o(4,"Descripci\xF3n"),r(),e(5,"th",40),o(6,"Valor"),r(),e(7,"th",40),o(8,"Duraci\xF3n"),r(),e(9,"th",40),o(10,"Opci\xF3n"),r()())}function fe(l,t){if(l&1){let i=_();e(0,"tr")(1,"td"),o(2),r(),e(3,"td"),o(4),r(),e(5,"td"),o(6),w(7,"currency"),r(),e(8,"td"),o(9),r(),e(10,"td")(11,"div",41)(12,"button",42),v("click",function(){let a=C(i).$implicit,m=E();return b(m.eliminarServicio(a.id_servicio))}),p(13,"img",43),r()()()()}if(l&2){let i=t.$implicit;s(2),S(i.nombre_servicio),s(2),S(i.descrip_servicio),s(2),S(I(7,4,i.valor_servicio)),s(3),S(i.tiempo_estimado)}}function de(l,t){if(l&1){let i=_();e(0,"p-button",44),v("onClick",function(){C(i);let a=E();return b(a.editEntry())}),r()}}function ve(l,t){if(l&1){let i=_();e(0,"p-button",45),v("onClick",function(){C(i);let a=E();return b(a.saveVehicle())}),r()}}var oe=class l{constructor(t,i,n,a){this.servicesService=t;this.router=i;this.vehiclesService=n;this.entryService=a;this.tiposVehiculo=[{tipo:"Moto"},{tipo:"Autom\xF3vil"},{tipo:"Camioneta"},{tipo:"Cami\xF3n"},{tipo:"Furgoneta"},{tipo:"Pickup"},{tipo:"Bus"},{tipo:"Buseta"},{tipo:"Ambulancia"}],this.servicesService.getAllServices().subscribe({next:m=>{this.servicios=m,this.filterAsignedServices()},error:m=>{console.error("Error obteniendo servicios:",m)}}),this.vehiclesService.getAll().subscribe(m=>{this.vehicles=m,console.log(this.vehicles)})}flagEdit=!1;tiposVehiculo=[];servicios=[];selectedService;selectedServices=[];totalToPay=0;vehicles=[];vehicles_filtered=[];tipo_selected;entryToEdit;vehicleForm=new T({placa:new u(null,f.required),marca:new u("",f.required),linea:new u("",f.required),tipo:new u(null,f.required),clave:new u(""),nombre_prop:new u("",f.required),contacto:new u("",f.required)});serviceForm=new T({servicio:new u(null,f.required)});ngOnInit(){this.entryToEdit=this.entryService.getEntrySelected(),this.entryToEdit!==null&&(this.flagEdit=!0,this.vehicleForm.patchValue(this.entryToEdit.Vehicle))}filterAsignedServices(){this.entryToEdit!==null&&(this.selectedServices=this.servicios.filter(t=>this.entryToEdit?.AsignedServices.some(i=>i.id_servicio===t.id_servicio)))}filterVehicle(t){let i=typeof t.value=="string"?t.value.toUpperCase():"";if(this.vehicleForm.get("placa")?.setValue(i,{emitEvent:!1}),typeof t.value=="object"&&t.value.placa){this.vehicleForm.patchValue(t.value),this.tipo_selected=t.value.tipo,console.log(this.tipo_selected);return}let n=i.trim();n.length>1?this.vehicles_filtered=this.vehicles.filter(a=>{let m=a.placa.toLowerCase(),ne=n.toLowerCase();return m.startsWith(ne)}):this.vehicles_filtered=[],n===""&&this.vehicleForm.reset()}editEntry(){if(this.vehicleForm.invalid)c.default.fire({position:"center",icon:"error",title:"Informacion incompleta",text:"Debe ingresar la informaci\xF3n en todos los campos",showConfirmButton:!1,timer:1500});else if(this.selectedServices.length===0)c.default.fire({position:"center",icon:"error",title:"Informacion incompleta",text:"Debe asignar por lo menos 1 servicio",showConfirmButton:!1,timer:1500});else{let t=this.vehicleForm.value;console.log(t),this.entryService.editEntry(t,this.selectedServices,this.entryToEdit.id_ingreso).subscribe(i=>{c.default.fire({position:"center",icon:"success",title:"Ingreso actualizado",showConfirmButton:!1,timer:1500}),this.entryService.setEntry(null),this.serviceForm.reset(),this.vehicleForm.reset(),this.selectedServices.length=0,this.router.navigate(["vehicles"])},i=>{c.default.fire({position:"center",icon:"error",title:"Ocurri\xF3 un error",text:"No fue posible actualizar el ingreso",showConfirmButton:!1,timer:1500})})}}saveVehicle(){if(this.vehicleForm.invalid)c.default.fire({position:"center",icon:"error",title:"Informacion incompleta",text:"Debe ingresar la informaci\xF3n en todos los campos",showConfirmButton:!1,timer:1500});else if(this.selectedServices.length===0)c.default.fire({position:"center",icon:"error",title:"Informacion incompleta",text:"Debe asignar por lo menos 1 servicio",showConfirmButton:!1,timer:1500});else{let t=this.vehicleForm.value;console.log(t),this.entryService.saveEntry(t,this.selectedServices).subscribe(i=>{c.default.fire({position:"center",icon:"success",title:"Ingreso registrado",showConfirmButton:!1,timer:1500}),this.serviceForm.reset(),this.vehicleForm.reset(),this.selectedServices.length=0,this.router.navigate(["vehicles"])},i=>{c.default.fire({position:"center",icon:"error",title:"Ocurri\xF3 un error",text:"No fue posible registrar el ingreso",showConfirmButton:!1,timer:1500})})}}addService(){let t=this.serviceForm.get("servicio")?.value;t&&!this.selectedServices.some(i=>i.id_servicio===t.id_servicio)?(this.selectedServices.push(t),this.serviceForm.reset()):c.default.fire({position:"center",icon:"error",title:"Ya esta agregado",text:"Debe registrar un servicio distinto",showConfirmButton:!1,timer:1500})}eliminarServicio(t){c.default.fire({title:"\xBFEsta seguro?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#32cd32",cancelButtonColor:"#d33",confirmButtonText:"Confirmar",cancelButtonText:"Cancelar"}).then(i=>{i.isConfirmed&&(this.selectedServices=this.selectedServices.filter(n=>n.id_servicio!==t),c.default.fire({showConfirmButton:!1,title:"Servicio eliminado",icon:"error",timer:1500}))})}getTotalServicios(){return this.selectedServices.reduce((t,i)=>t+(i.valor_servicio||0),0)}cancelar(){c.default.fire({title:"\xBFEsta seguro?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#32cd32",cancelButtonColor:"#d33",confirmButtonText:"Confirmar",cancelButtonText:"Cancelar"}).then(t=>{t.isConfirmed&&(c.default.fire({showConfirmButton:!1,title:"Registro cancelado",icon:"error",timer:1500}),this.entryService.setEntry(null),this.serviceForm.reset(),this.vehicleForm.reset(),this.selectedServices.length=0,this.router.navigate(["vehicles"]))})}static \u0275fac=function(i){return new(i||l)(h(ie),h(k),h(x),h(re))};static \u0275cmp=B({type:l,selectors:[["app-entry"]],decls:71,vars:13,consts:[[1,"flex","flex-col","justify-center","px-6","py-12","w-screen"],[1,"flex","items-center","justify-center"],[1,"text-white","text-4xl","font-bold","text-center"],[1,"mt-5","sm:mx-auto","sm:w-full","sm:max-w-sm"],[1,"text-white","text-2xl"],[1,"border-2","rounded-xl","border-white","p-4"],[1,"space-y-3",3,"formGroup"],[1,"grid","grid-cols-2","gap-2"],["variant","in"],["optionLabel","placa","formControlName","placa",1,"w-full",3,"onChange","options","editable"],["for","placa"],["pInputText","","id","marca","autocomplete","on","formControlName","marca",1,"w-full"],["for","marca"],["pInputText","","id","linea","autocomplete","on","formControlName","linea",1,"w-full"],["for","linea"],["formControlName","tipo","optionLabel","tipo","optionValue","tipo",1,"w-full",3,"options"],["for","tipo"],["pInputText","","id","propietario","autocomplete","off","formControlName","nombre_prop",1,"w-full"],["for","propietario"],["pInputText","","id","contacto","autocomplete","off","formControlName","contacto",1,"w-full"],["for","contacto"],["pInputText","","id","clave","autocomplete","off","formControlName","clave",1,"w-full"],["for","clave"],["formControlName","servicio","optionLabel","nombre_servicio",1,"w-full",3,"options"],["for","servicio"],[1,"flex","justify-center"],["severity","info","label","ASIGNAR",3,"onClick"],[1,"mt-5","h-[400px]","bg-white","rounded-lg","p-4","flex","flex-col","items-center","text-center"],[1,"text-xl","font-bold","mb-4","italic","text-gray-400"],[1,"w-full","overflow-auto"],["stripedRows","","scrollHeight","300px",3,"value","scrollable"],["pTemplate","header"],["pTemplate","body"],[1,"text-l","font-bold","mb-4","italic","text-white"],[1,"flex","justify-center","gap-4"],["severity","success","label","EDITAR"],["severity","success","label","GUARDAR"],["severity","danger","label","CANCELAR",3,"onClick"],[2,"color","cornflowerblue","width","30%"],[2,"color","cornflowerblue","width","40%"],[2,"color","cornflowerblue","width","10%"],[1,"w-full","flex","justify-center"],["title","eliminar",1,"transition-all","duration-300","active:brightness-80",3,"click"],["src","iconos-botones/eliminar.png","alt","",1,"w-[30px]"],["severity","success","label","EDITAR",3,"onClick"],["severity","success","label","GUARDAR",3,"onClick"]],template:function(i,n){i&1&&(e(0,"div",0)(1,"div",1),g(2,me,2,0,"h1",2)(3,pe,2,0,"h1",2),r(),e(4,"div",3)(5,"h2",4),o(6,"Informaci\xF3n del veh\xEDculo"),r(),e(7,"div",5)(8,"form",6)(9,"div",7)(10,"div")(11,"p-floatlabel",8)(12,"p-select",9),v("onChange",function(m){return n.filterVehicle(m)}),r(),e(13,"label",10),o(14,"Placa"),r()()(),e(15,"div")(16,"p-floatlabel",8),p(17,"input",11),e(18,"label",12),o(19,"Marca"),r()()(),e(20,"div")(21,"p-floatlabel",8),p(22,"input",13),e(23,"label",14),o(24,"L\xEDnea"),r()()(),e(25,"div")(26,"p-floatlabel",8),p(27,"p-select",15),e(28,"label",16),o(29,"Tipo"),r()()(),e(30,"div")(31,"p-floatlabel",8),p(32,"input",17),e(33,"label",18),o(34,"Propietario"),r()()(),e(35,"div")(36,"p-floatlabel",8),p(37,"input",19),e(38,"label",20),o(39,"Contacto"),r()()(),e(40,"div")(41,"p-floatlabel",8),p(42,"input",21),e(43,"label",22),o(44,"Clave"),r()()()()()()(),e(45,"div",3)(46,"h2",4),o(47,"Asignaci\xF3n de servicio"),r(),e(48,"div",5)(49,"form",6)(50,"div")(51,"p-floatlabel",8),p(52,"p-select",23),e(53,"label",24),o(54,"Servicios"),r()()(),e(55,"div",25)(56,"p-button",26),v("onClick",function(){return n.addService()}),r()()()()(),e(57,"div",27)(58,"h2",28),o(59," LISTA DE SERVICIOS ASIGNADOS "),r(),e(60,"div",29)(61,"p-table",30),g(62,ue,11,0,"ng-template",31)(63,fe,14,6,"ng-template",32),r()()(),e(64,"h2",33),o(65),w(66,"currency"),r(),e(67,"div",34),g(68,de,1,0,"p-button",35)(69,ve,1,0,"p-button",36),e(70,"p-button",37),v("onClick",function(){return n.cancelar()}),r()()()),i&2&&(s(2),y(n.flagEdit?2:3),s(6),d("formGroup",n.vehicleForm),s(4),d("options",n.vehicles_filtered)("editable",!0),s(15),d("options",n.tiposVehiculo),s(22),d("formGroup",n.serviceForm),s(3),d("options",n.servicios),s(9),d("value",n.selectedServices)("scrollable",!0),s(4),A(" Total a pagar: ",I(66,11,n.getTotalServicios())," "),s(3),y(n.flagEdit?68:69))},dependencies:[Y,H,q,P,U,$,z,G,O,M,Q,K,J,L,Z,X,te,ee,D,N,W],encapsulation:2})};export{oe as EntryComponent};
